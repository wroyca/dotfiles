#!/usr/bin/env bash

# Get the current color scheme from GNOME settings
mode=$(gsettings get org.gnome.desktop.interface color-scheme)

set_color_scheme()
{
  case "$mode" in
    *dark* )
      kitty +kitten themes --reload-in=all "Neovim-Dark" 2>/dev/null
      ;;
    *default* | *light* )
      kitty +kitten themes --reload-in=all "Neovim-Light" 2>/dev/null
      ;;
    * )
      echo "Unknown color scheme mode: $mode" >&2
      ;;
  esac
}

# Monitor changes to the color scheme and apply the appropriate theme
gsettings monitor org.gnome.desktop.interface color-scheme | \
  while read -r line; do
    mode=$(echo "$line" | awk '{print $NF}')  # Extract the last field which is the new mode
    set_color_scheme
  done 2>/dev/null &
